



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Dropwizard guice integration">
      
      
        <link rel="canonical" href="https://xvik.github.io/dropwizard-guicey/4.1.0/guide/lifecycle/">
      
      
        <meta name="author" content="Vyacheslav Rusakov">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.1">
    
    
      
        <title>Integration lifecycle - Dropwizard-guicey</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.41c6761c.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://xvik.github.io/dropwizard-guicey/4.1.0" title="Dropwizard-guicey" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Dropwizard-guicey
              </span>
              <span class="md-header-nav__topic">
                Integration lifecycle
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/xvik/dropwizard-guicey/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      dropwizard-guicey
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Dropwizard-guicey
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/xvik/dropwizard-guicey/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      dropwizard-guicey
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      User guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        User guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Integration lifecycle
      </label>
    
    <a href="./" title="Integration lifecycle" class="md-nav__link md-nav__link--active">
      Integration lifecycle
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lifecycle" title="Lifecycle" class="md-nav__link">
    Lifecycle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-context-bindings" title="Cross context bindings" class="md-nav__link">
    Cross context bindings
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-jersey-beans-from-guice" title="Access jersey beans from guice" class="md-nav__link">
    Access jersey beans from guice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-guice-beans-from-jersey" title="Access guice beans from jersey" class="md-nav__link">
    Access guice beans from jersey
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problematic-cases" title="Problematic cases" class="md-nav__link">
    Problematic cases
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../injector/" title="Injector" class="md-nav__link">
      Injector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../module-autowiring/" title="Module autowiring" class="md-nav__link">
      Module autowiring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bindings/" title="Bindings" class="md-nav__link">
      Bindings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scan/" title="Classpath scan" class="md-nav__link">
      Classpath scan
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../installers/" title="Installers" class="md-nav__link">
      Installers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ordering/" title="Ordering" class="md-nav__link">
      Ordering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bundles/" title="Bundles (Guicey)" class="md-nav__link">
      Bundles (Guicey)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../options/" title="Options" class="md-nav__link">
      Options
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../diagnostic/" title="Diagnostic" class="md-nav__link">
      Diagnostic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../commands/" title="Commands" class="md-nav__link">
      Commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../test/" title="Test" class="md-nav__link">
      Test
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Installers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Installers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/resource/" title="Resource" class="md-nav__link">
      Resource
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/task/" title="Task" class="md-nav__link">
      Task
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/managed/" title="Managed" class="md-nav__link">
      Managed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/lifecycle/" title="Lifecycle" class="md-nav__link">
      Lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/healthcheck/" title="Health check" class="md-nav__link">
      Health check
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/jersey-ext/" title="Jersey extension" class="md-nav__link">
      Jersey extension
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/jersey-feature/" title="Jersey feature" class="md-nav__link">
      Jersey feature
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/eager/" title="Eager singleton" class="md-nav__link">
      Eager singleton
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/plugin/" title="Plugin" class="md-nav__link">
      Plugin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/servlet/" title="Web servlet" class="md-nav__link">
      Web servlet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/filter/" title="Web filter" class="md-nav__link">
      Web filter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/listener/" title="Web listener" class="md-nav__link">
      Web listener
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/authentication/" title="Authentication" class="md-nav__link">
      Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/governator/" title="Governator" class="md-nav__link">
      Governator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/hibernate/" title="Hibernate" class="md-nav__link">
      Hibernate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/eventbus/" title="EventBus" class="md-nav__link">
      EventBus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/jdbi/" title="JDBI" class="md-nav__link">
      JDBI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Extras
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Extras
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../extras/admin-rest/" title="Admin REST" class="md-nav__link">
      Admin REST
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extras/bom/" title="BOM" class="md-nav__link">
      BOM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extras/eventbus/" title="Guava EventBus" class="md-nav__link">
      Guava EventBus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extras/jdbi/" title="JDBI" class="md-nav__link">
      JDBI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extras/spa/" title="SPA" class="md-nav__link">
      SPA
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/compatibility/" title="Compatibility" class="md-nav__link">
      Compatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/history/" title="Release notes" class="md-nav__link">
      Release notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/support/" title="Support" class="md-nav__link">
      Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lifecycle" title="Lifecycle" class="md-nav__link">
    Lifecycle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-context-bindings" title="Cross context bindings" class="md-nav__link">
    Cross context bindings
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-jersey-beans-from-guice" title="Access jersey beans from guice" class="md-nav__link">
    Access jersey beans from guice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-guice-beans-from-jersey" title="Access guice beans from jersey" class="md-nav__link">
    Access guice beans from jersey
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problematic-cases" title="Problematic cases" class="md-nav__link">
    Problematic cases
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/xvik/dropwizard-guicey/edit/master/src/doc/docs/guide/lifecycle.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="integration-lifecycle">Integration lifecycle<a class="headerlink" href="#integration-lifecycle" title="Permanent link">&para;</a></h1>
<p>Jersey2 guice integration is more complicated than for jersey1, because of <a href="https://hk2.java.net/2.4.0-b34/introduction.html">HK2</a> container, used by jersey2.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many people ask why not just use HK2 instead of guice as it's already provided. Unfortunately, it's hard to use it 
in the same elegant way as we can use guice. HK context is launched too late (after dropwizard run phase).
For example, it is impossible to use HK to instantiate dropwizard managed object because managed
must be registered before HK context starts.</p>
</div>
<p>Guice integration done in guice exclusive way as much as possible: everything should be managed by guice and invisibly integrated into HK2.
Anyway, it is not always possible to hide integration details, especially if you need to register jersey extensions.</p>
<div class="admonition warning">
<p>Guice context starts before HK context.</p>
</div>
<h2 id="lifecycle">Lifecycle<a class="headerlink" href="#lifecycle" title="Permanent link">&para;</a></h2>
<ul>
<li>Dropwizard configuration phase    <ul>
<li>Guice bundle registered (in application <code>initialize</code> method)</li>
<li>Perform <a href="../commands/#automatic-installation">classpath scan for commands</a> (<a href="../configuration/#commands-search">optional</a>)</li>
</ul>
</li>
<li>Dropwizard run phase<ul>
<li>Dropwizard runs bundles (guice bundle is one of them so guice initialization may be performed between other dropwizard bundles)</li>
<li>Search guicey bundles in dropwizard bundles (<a href="../configuration/#dropwizard-bundles-unification">optional</a>) </li>
<li><a href="../bundles/#bundle-lookup">Lookup guicey bundles</a>   </li>
<li>Apply configuration from guicey bundles</li>
<li><strong>Injector creation</strong> (<a href="../injector/#injector-factory">using factory</a>)<ul>
<li><a href="../bindings/">Bind dropwizard objects</a>: Environment, Configuration, Bootstrap</li>
<li>Scan for installers (in auto configuration mode)</li>
<li>Scan for extensions (in auto configuration mode)</li>
<li>Register <code>GuiceFeature</code> in environment (jersey <code>Feature</code> which will trigger jersey side installations)</li>
<li>Apply <a href="https://github.com/xvik/dropwizard-guicey/tree/master/src/main/java/ru/vyarus/dropwizard/guice/module/jersey/hk2/GuiceBindingsModule.java">lazy jersey bindings</a></li>
<li>Activate <a href="../web/">guice servlet support</a>, register GuiceFilter on admin and main contexts (<a href="../configuration/#servletmodule">could be disabled</a>)</li>
</ul>
</li>
<li>Injector created<ul>
<li>Call installers to register extensions</li>
</ul>
</li>
<li>Your application's <code>run</code> method executed. Injector is already available, so any guice bean could be <a href="../injector/">accessed</a>          </li>
</ul>
</li>
<li>Jersey start<ul>
<li><a href="../../installers/managed/">Managed beans</a> started</li>
<li><strong>HK2 context creation</strong><ul>
<li><code>GuiceFeature</code> (registered earlier) called<ul>
<li><a href="../configuration/#hk-bridge">Optionally</a> register <a href="https://hk2.java.net/2.4.0-b34/guice-bridge.html">hk2-guice bridge</a> (only guice to hk way to let hk managed beans inject guice beans)</li>
<li>Run jersey specific installers (<a href="../../installers/resource/">resource</a>, <a href="../../installers/jersey-ext/">extension</a>)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Any <code>EnvironmentCommand</code> did no start jersey, so managed objects will not be started.
Also, all jersey related extensions will not be started. Still, core guice context will be completely operable. </p>
</div>
<div class="admonition attention">
<p>When guice context is created, <em>jersey context doesn't exist</em> and when jersey context is created <em>it doesn't aware of guice existence</em>.</p>
</div>
<h2 id="cross-context-bindings">Cross context bindings<a class="headerlink" href="#cross-context-bindings" title="Permanent link">&para;</a></h2>
<h3 id="access-jersey-beans-from-guice">Access jersey beans from guice<a class="headerlink" href="#access-jersey-beans-from-guice" title="Permanent link">&para;</a></h3>
<p>To access HK bindings we need HK2 <code>ServiceLocator</code>: it's instance is registered by <code>GuiceFeature</code> (in time of HK context startup).</p>
<p>Jersey components are bound as providers:</p>
<div class="codehilite"><pre><span></span><span class="n">binder</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">jerseyType</span><span class="o">).</span><span class="na">toProvider</span><span class="o">(</span><span class="k">new</span> <span class="n">LazyJerseyProvider</span><span class="o">(</span><span class="n">jerseyType</span><span class="o">));</span>
</pre></div>

<p>Internally this provider will perform lookup in HK service locator:</p>
<div class="codehilite"><pre><span></span><span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">ServiceLocator</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getService</span><span class="o">(</span><span class="n">jerseyType</span><span class="o">);</span>
</pre></div>

<p>This way jersey beans are "bridged" to guice. They can't be accessed directly in guice beans
at injector creation time (as there is nothing to "bridge" yet). </p>
<p><code class="codehilite"><span class="nd">@Inject</span> <span class="n">Provider</span><span class="o">&lt;</span><span class="n">JerseyType</span><span class="o">&gt;</span> <span class="n">provider</span></code> must be used to access such beans.     </p>
<p>See more details in <a href="https://github.com/xvik/dropwizard-guicey/tree/master/src/main/java/ru/vyarus/dropwizard/guice/module/jersey/hk2/GuiceBindingsModule.java">jersey bindings module</a>.</p>
<h3 id="access-guice-beans-from-jersey">Access guice beans from jersey<a class="headerlink" href="#access-guice-beans-from-jersey" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It's almost never required to care about beans visibility from HK side because guicey already did all required
bindings.</p>
</div>
<p>HK could see all guice beans because of registered guice-bridge. But it doesn't mean HK can analyze 
all guice beans to search for extensions (it can resolve only direct injection).</p>
<p>Specific jersey installers (<a href="../../installers/resource/">resource</a>, <a href="../../installers/jersey-ext/">extension</a>) 
create required bindings manually in time of HK context creation.</p>
<p><a href="../../installers/jersey-ext/">Jersey extensions installer</a> handles most specific installation cases
(where HK knowledge is required). It uses the same technic, as the other side binding:</p>
<div class="codehilite"><pre><span></span><span class="n">binder</span><span class="o">.</span><span class="na">bindFactory</span><span class="o">(</span><span class="k">new</span> <span class="n">LazyGuiceProvider</span><span class="o">(</span><span class="n">guiceType</span><span class="o">)).</span><span class="na">to</span><span class="o">(</span><span class="n">type</span><span class="o">)</span>
</pre></div>

<p>On request, factory will simply delegate lookup to guice injector:</p>
<div class="codehilite"><pre><span></span><span class="n">injector</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">guiceType</span><span class="o">);</span>
</pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you just want to add some beans in HK context, annotate such beans with <code>@Provider</code> and <code>@HK2Managed</code> - provider
will be recognized by installer and hk managed annotation will trigger simple registration (overall it's the same
as write binding manually).
<div class="codehilite"><pre><span></span><span class="nd">@HK2Managed</span>
<span class="nd">@Provider</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBeanMangedByHK</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>    
</pre></div></p>
</div>
<p>For more details look <a href="https://github.com/xvik/dropwizard-guicey/tree/master/src/main/java/ru/vyarus/dropwizard/guice/module/installer/feature/jersey/provider/JerseyProviderInstaller.java">jersey provider installer</a></p>
<h2 id="problematic-cases">Problematic cases<a class="headerlink" href="#problematic-cases" title="Permanent link">&para;</a></h2>
<p>The problems may appear with binding of jersey extensions.
Good example is <a href="../../installers/jersey-ext/#valuefactoryprovider"><code>ValueFactoryProvider</code></a>. Most likely you will use <code>AbstractValueFactoryProvider</code> as base class, but it declares
direct binding for <code>MultivaluedParameterExtractorProvider</code>. So such bean would be impossible to create eagerly in guice context.</p>
<p>There are two options to solve this:</p>
<ul>
<li>use <code>@LazyBinding</code>: bean instance will not be created together with guice context (when <code>MultivaluedParameterExtractorProvider</code> is not available),
and creation will be initiated by HK, when binding could be resolved.</li>
<li>or use <code>@HK2Managed</code> this will delegate instance management to HK, but still guice services <a href="../configuration/#hk-bridge">may be injected</a>.</li>
</ul>
<p>In other cases simply wrap jersey specific bindings into <code>Provider</code>.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../configuration/" title="Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Configuration
              </span>
            </div>
          </a>
        
        
          <a href="../injector/" title="Injector" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Injector
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2014-2017 Vyacheslav Rusakov
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/xvik" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/vyarus" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-93174150-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>